var Nn=Object.defineProperty;var Ln=(e,t,n)=>t in e?Nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Y=(e,t,n)=>Ln(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();class Gt{unwrap(t,n){const i=this._chain(o=>C.ok(t?t(o):o),o=>n?C.ok(n(o)):C.err(o));if(i.isErr)throw i.error;return i.value}map(t,n){return this._chain(i=>C.ok(t(i)),i=>C.err(n?n(i):i))}chain(t,n){return this._chain(t,n||(i=>C.err(i)))}}class Kn extends Gt{constructor(t){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=t}_chain(t,n){return t(this.value)}}class $n extends Gt{constructor(t){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=t}_chain(t,n){return n(this.error)}}var C;(function(e){e.ok=function(t){return new Kn(t)},e.err=function(t){return new $n(t||new Error)},e.all=function(t){if(Array.isArray(t)){const o=[];for(let r=0;r<t.length;r++){const s=t[r];if(s.isErr)return s;o.push(s.value)}return e.ok(o)}const n={},i=Object.keys(t);for(let o=0;o<i.length;o++){const r=t[i[o]];if(r.isErr)return r;n[i[o]]=r.value}return e.ok(n)}})(C||(C={}));const vt=e=>(e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),Xe=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),yt=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,Xe(e));class h{constructor(t,n){this.lo=t|0,this.hi=n|0}static fromSquare(t){return t>=32?new h(0,1<<t-32):new h(1<<t,0)}static fromRank(t){return new h(255,0).shl64(8*t)}static fromFile(t){return new h(16843009<<t,16843009<<t)}static empty(){return new h(0,0)}static full(){return new h(4294967295,4294967295)}static corners(){return new h(129,2164260864)}static center(){return new h(402653184,24)}static backranks(){return new h(255,4278190080)}static backrank(t){return t==="white"?new h(255,0):new h(0,4278190080)}static lightSquares(){return new h(1437226410,1437226410)}static darkSquares(){return new h(2857740885,2857740885)}complement(){return new h(~this.lo,~this.hi)}xor(t){return new h(this.lo^t.lo,this.hi^t.hi)}union(t){return new h(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new h(this.lo&t.lo,this.hi&t.hi)}diff(t){return new h(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?h.empty():t>=32?new h(this.hi>>>t-32,0):t>0?new h(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?h.empty():t>=32?new h(0,this.lo<<t-32):t>0?new h(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new h(Xe(this.hi),Xe(this.lo))}rbit64(){return new h(yt(this.hi),yt(this.lo))}minus64(t){const n=this.lo-t.lo,i=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new h(n,this.hi-(t.hi+i))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return vt(this.lo)+vt(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(t){return(t>=32?this.hi&1<<t-32:this.lo&1<<t)!==0}set(t,n){return n?this.with(t):this.without(t)}with(t){return t>=32?new h(this.lo,this.hi|1<<t-32):new h(this.lo|1<<t,this.hi)}without(t){return t>=32?new h(this.lo,this.hi&~(1<<t-32)):new h(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new h(this.lo,this.hi^1<<t-32):new h(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new h(this.lo&this.lo-1,this.hi):new h(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,n=this.hi;for(;t!==0;){const i=31-Math.clz32(t&-t);t^=1<<i,yield i}for(;n!==0;){const i=31-Math.clz32(n&-n);n^=1<<i,yield 32+i}}*reversed(){let t=this.lo,n=this.hi;for(;n!==0;){const i=31-Math.clz32(n);n^=1<<i,yield 32+i}for(;t!==0;){const i=31-Math.clz32(t);t^=1<<i,yield i}}}const Ut=["a","b","c","d","e","f","g","h"],_n=["1","2","3","4","5","6","7","8"],ae=["white","black"],W=["pawn","knight","bishop","rook","queen","king"],Bn=["a","h"],Re=e=>"role"in e,y=e=>e!==void 0,K=e=>e==="white"?"black":"white",Se=e=>e>>3,V=e=>e&7,Ye=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,Zt=e=>{switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function Qe(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function se(e){if(e.length===2)return Ye(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const ge=e=>Ut[V(e)]+_n[Se(e)],de=e=>{if(e[1]==="@"&&e.length===4){const t=Qe(e[0]),n=se(e.slice(2));if(t&&y(n))return{role:t,to:n}}else if(e.length===4||e.length===5){const t=se(e.slice(0,2)),n=se(e.slice(2,4));let i;if(e.length===5&&(i=Qe(e[4]),!i))return;if(y(t)&&y(n))return{from:t,to:n,promotion:i}}},lt=(e,t)=>e==="white"?t==="a"?2:6:t==="a"?58:62,at=(e,t)=>e==="white"?t==="a"?3:5:t==="a"?59:61,Te=(e,t)=>{let n=h.empty();for(const i of t){const o=e+i;0<=o&&o<64&&Math.abs(V(e)-V(o))<=2&&(n=n.with(o))}return n},ee=e=>{const t=[];for(let n=0;n<64;n++)t[n]=e(n);return t},Hn=ee(e=>Te(e,[-9,-8,-7,-1,1,7,8,9])),Fn=ee(e=>Te(e,[-17,-15,-10,-6,6,10,15,17])),qn={white:ee(e=>Te(e,[7,9])),black:ee(e=>Te(e,[-7,-9]))},Xt=e=>Hn[e],Yt=e=>Fn[e],Fe=(e,t)=>qn[e][t],Je=ee(e=>h.fromFile(V(e)).without(e)),Ve=ee(e=>h.fromRank(Se(e)).without(e)),et=ee(e=>{const t=new h(134480385,2151686160),n=8*(Se(e)-V(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),tt=ee(e=>{const t=new h(270549120,16909320),n=8*(Se(e)+V(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),nt=(e,t,n)=>{let i=n.intersect(t),o=i.bswap64();return i=i.minus64(e),o=o.minus64(e.bswap64()),i.xor(o.bswap64()).intersect(t)},In=(e,t)=>nt(h.fromSquare(e),Je[e],t),Wn=(e,t)=>{const n=Ve[e];let i=t.intersect(n),o=i.rbit64();return i=i.minus64(h.fromSquare(e)),o=o.minus64(h.fromSquare(63-e)),i.xor(o.rbit64()).intersect(n)},ze=(e,t)=>{const n=h.fromSquare(e);return nt(n,et[e],t).xor(nt(n,tt[e],t))},De=(e,t)=>In(e,t).xor(Wn(e,t)),jn=(e,t)=>ze(e,t).xor(De(e,t)),Qt=(e,t)=>{const n=h.fromSquare(t);return Ve[e].intersects(n)?Ve[e].with(e):tt[e].intersects(n)?tt[e].with(e):et[e].intersects(n)?et[e].with(e):Je[e].intersects(n)?Je[e].with(e):h.empty()},ye=(e,t)=>Qt(e,t).intersect(h.full().shl64(e).xor(h.full().shl64(t))).withoutFirst();class ce{constructor(){}static default(){const t=new ce;return t.reset(),t}reset(){this.occupied=new h(65535,4294901760),this.promoted=h.empty(),this.white=new h(65535,0),this.black=new h(0,4294901760),this.pawn=new h(65280,16711680),this.knight=new h(66,1107296256),this.bishop=new h(36,603979776),this.rook=new h(129,2164260864),this.queen=new h(8,134217728),this.king=new h(16,268435456)}static empty(){const t=new ce;return t.clear(),t}clear(){this.occupied=h.empty(),this.promoted=h.empty();for(const t of ae)this[t]=h.empty();for(const t of W)this[t]=h.empty()}clone(){const t=new ce;t.occupied=this.occupied,t.promoted=this.promoted;for(const n of ae)t[n]=this[n];for(const n of W)t[n]=this[n];return t}getColor(t){if(this.white.has(t))return"white";if(this.black.has(t))return"black"}getRole(t){for(const n of W)if(this[n].has(t))return n}get(t){const n=this.getColor(t);if(!n)return;const i=this.getRole(t),o=this.promoted.has(t);return{color:n,role:i,promoted:o}}take(t){const n=this.get(t);return n&&(this.occupied=this.occupied.without(t),this[n.color]=this[n.color].without(t),this[n.role]=this[n.role].without(t),n.promoted&&(this.promoted=this.promoted.without(t))),n}set(t,n){const i=this.take(t);return this.occupied=this.occupied.with(t),this[n.color]=this[n.color].with(t),this[n.role]=this[n.role].with(t),n.promoted&&(this.promoted=this.promoted.with(t)),i}has(t){return this.occupied.has(t)}*[Symbol.iterator](){for(const t of this.occupied)yield[t,this.get(t)]}pieces(t,n){return this[t].intersect(this[n])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(t){return this.pieces(t,"king").singleSquare()}}var J;(function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"})(J||(J={}));class pe extends Error{}const Gn=(e,t,n,i)=>n[t].intersect(De(e,i).intersect(n.rooksAndQueens()).union(ze(e,i).intersect(n.bishopsAndQueens())).union(Yt(e).intersect(n.knight)).union(Xt(e).intersect(n.king)).union(Fe(K(t),e).intersect(n.pawn)));class re{constructor(){}static default(){const t=new re;return t.castlingRights=h.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new h(14,0),h:new h(96,0)},black:{a:new h(0,234881024),h:new h(0,1610612736)}},t}static empty(){const t=new re;return t.castlingRights=h.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:h.empty(),h:h.empty()},black:{a:h.empty(),h:h.empty()}},t}clone(){const t=new re;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(t,n,i,o){const r=lt(t,n),s=at(t,n);this.castlingRights=this.castlingRights.with(o),this.rook[t][n]=o,this.path[t][n]=ye(o,s).with(s).union(ye(i,r).with(r)).without(i).without(o)}static fromSetup(t){const n=re.empty(),i=t.castlingRights.intersect(t.board.rook);for(const o of ae){const r=h.backrank(o),s=t.board.kingOf(o);if(!y(s)||!r.has(s))continue;const c=i.intersect(t.board[o]).intersect(r),a=c.first();y(a)&&a<s&&n.add(o,"a",s,a);const u=c.last();y(u)&&s<u&&n.add(o,"h",s,u)}return n}discardRook(t){if(this.castlingRights.has(t)){this.castlingRights=this.castlingRights.without(t);for(const n of ae)for(const i of Bn)this.rook[n][i]===t&&(this.rook[n][i]=void 0)}}discardColor(t){this.castlingRights=this.castlingRights.diff(h.backrank(t)),this.rook[t].a=void 0,this.rook[t].h=void 0}}class Un{constructor(t){this.rules=t}reset(){this.board=ce.default(),this.pockets=void 0,this.turn="white",this.castles=re.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){this.board=t.board.clone(),this.board.promoted=h.empty(),this.pockets=void 0,this.turn=t.turn,this.castles=re.fromSetup(t),this.epSquare=Zn(this,t.epSquare),this.remainingChecks=void 0,this.halfmoves=t.halfmoves,this.fullmoves=t.fullmoves}kingAttackers(t,n,i){return Gn(t,n,this.board,i)}playCaptureAt(t,n){this.halfmoves=0,n.role==="rook"&&this.castles.discardRook(t),this.pockets&&this.pockets[K(n.color)][n.promoted?"pawn":n.role]++}ctx(){const t=this.isVariantEnd(),n=this.board.kingOf(this.turn);if(!y(n))return{king:n,blockers:h.empty(),checkers:h.empty(),variantEnd:t,mustCapture:!1};const i=De(n,h.empty()).intersect(this.board.rooksAndQueens()).union(ze(n,h.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[K(this.turn)]);let o=h.empty();for(const s of i){const c=ye(n,s).intersect(this.board.occupied);c.moreThanOne()||(o=o.union(c))}const r=this.kingAttackers(n,K(this.turn),this.board.occupied);return{king:n,blockers:o,checkers:r,variantEnd:t,mustCapture:!1}}clone(){var t,n;const i=new this.constructor;return i.board=this.board.clone(),i.pockets=(t=this.pockets)===null||t===void 0?void 0:t.clone(),i.turn=this.turn,i.castles=this.castles.clone(),i.epSquare=this.epSquare,i.remainingChecks=(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),i.halfmoves=this.halfmoves,i.fullmoves=this.fullmoves,i}validate(){if(this.board.occupied.isEmpty())return C.err(new pe(J.Empty));if(this.board.king.size()!==2)return C.err(new pe(J.Kings));if(!y(this.board.kingOf(this.turn)))return C.err(new pe(J.Kings));const t=this.board.kingOf(K(this.turn));return y(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?C.err(new pe(J.OppositeCheck)):h.backranks().intersects(this.board.pawn)?C.err(new pe(J.PawnsOnBackrank)):C.ok(void 0):C.err(new pe(J.Kings))}dropDests(t){return h.empty()}dests(t,n){if(n=n||this.ctx(),n.variantEnd)return h.empty();const i=this.board.get(t);if(!i||i.color!==this.turn)return h.empty();let o,r;if(i.role==="pawn"){o=Fe(this.turn,t).intersect(this.board[K(this.turn)]);const s=this.turn==="white"?8:-8,c=t+s;if(0<=c&&c<64&&!this.board.occupied.has(c)){o=o.with(c);const a=this.turn==="white"?t<16:t>=48,u=c+s;a&&!this.board.occupied.has(u)&&(o=o.with(u))}y(this.epSquare)&&Yn(this,t,n)&&(r=h.fromSquare(this.epSquare))}else i.role==="bishop"?o=ze(t,this.board.occupied):i.role==="knight"?o=Yt(t):i.role==="rook"?o=De(t,this.board.occupied):i.role==="queen"?o=jn(t,this.board.occupied):o=Xt(t);if(o=o.diff(this.board[this.turn]),y(n.king)){if(i.role==="king"){const s=this.board.occupied.without(t);for(const c of o)this.kingAttackers(c,K(this.turn),s).nonEmpty()&&(o=o.without(c));return o.union(Ct(this,"a",n)).union(Ct(this,"h",n))}if(n.checkers.nonEmpty()){const s=n.checkers.singleSquare();if(!y(s))return h.empty();o=o.intersect(ye(s,n.king).with(s))}n.blockers.has(t)&&(o=o.intersect(Qt(t,n.king)))}return r&&(o=o.union(r)),o}isVariantEnd(){return!1}variantOutcome(t){}hasInsufficientMaterial(t){return this.board[t].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[t].intersects(this.board.knight)?this.board[t].size()<=2&&this.board[K(t)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[t].intersects(this.board.bishop)?(!this.board.bishop.intersects(h.darkSquares())||!this.board.bishop.intersects(h.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var t,n;return{board:this.board.clone(),pockets:(t=this.pockets)===null||t===void 0?void 0:t.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:Xn(this),remainingChecks:(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return ae.every(t=>this.hasInsufficientMaterial(t))}hasDests(t){t=t||this.ctx();for(const n of this.board[this.turn])if(this.dests(n,t).nonEmpty())return!0;return this.dropDests(t).nonEmpty()}isLegal(t,n){if(Re(t))return!this.pockets||this.pockets[this.turn][t.role]<=0||t.role==="pawn"&&h.backranks().has(t.to)?!1:this.dropDests(n).has(t.to);{if(t.promotion==="pawn"||t.promotion==="king"&&this.rules!=="antichess"||!!t.promotion!==(this.board.pawn.has(t.from)&&h.backranks().has(t.to)))return!1;const i=this.dests(t.from,n);return i.has(t.to)||i.has(Qn(this,t).to)}}isCheck(){const t=this.board.kingOf(this.turn);return y(t)&&this.kingAttackers(t,K(this.turn),this.board.occupied).nonEmpty()}isEnd(t){return(t?t.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(t)}isCheckmate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.nonEmpty()&&!this.hasDests(t)}isStalemate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.isEmpty()&&!this.hasDests(t)}outcome(t){const n=this.variantOutcome(t);return n||(t=t||this.ctx(),this.isCheckmate(t)?{winner:K(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(t)?{winner:void 0}:void 0)}allDests(t){t=t||this.ctx();const n=new Map;if(t.variantEnd)return n;for(const i of this.board[this.turn])n.set(i,this.dests(i,t));return n}play(t){const n=this.turn,i=this.epSquare,o=Jt(this,t);if(this.epSquare=void 0,this.halfmoves+=1,n==="black"&&(this.fullmoves+=1),this.turn=K(n),Re(t))this.board.set(t.to,{role:t.role,color:n}),this.pockets&&this.pockets[n][t.role]--,t.role==="pawn"&&(this.halfmoves=0);else{const r=this.board.take(t.from);if(!r)return;let s;if(r.role==="pawn"){this.halfmoves=0,t.to===i&&(s=this.board.take(t.to+(n==="white"?-8:8)));const c=t.from-t.to;Math.abs(c)===16&&8<=t.from&&t.from<=55&&(this.epSquare=t.from+t.to>>1),t.promotion&&(r.role=t.promotion,r.promoted=!!this.pockets)}else if(r.role==="rook")this.castles.discardRook(t.from);else if(r.role==="king"){if(o){const c=this.castles.rook[n][o];if(y(c)){const a=this.board.take(c);this.board.set(lt(n,o),r),a&&this.board.set(at(n,o),a)}}this.castles.discardColor(n)}if(!o){const c=this.board.set(t.to,r)||s;c&&this.playCaptureAt(t.to,c)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[n]=Math.max(this.remainingChecks[n]-1,0))}}class Pt extends Un{constructor(){super("chess")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(i=>n)}clone(){return super.clone()}}const Zn=(e,t)=>{if(!y(t))return;const n=e.turn==="white"?5:2,i=e.turn==="white"?8:-8;if(Se(t)!==n||e.board.occupied.has(t+i))return;const o=t-i;if(!(!e.board.pawn.has(o)||!e.board[K(e.turn)].has(o)))return t},Xn=e=>{if(!y(e.epSquare))return;const t=e.ctx(),i=e.board.pieces(e.turn,"pawn").intersect(Fe(K(e.turn),e.epSquare));for(const o of i)if(e.dests(o,t).has(e.epSquare))return e.epSquare},Yn=(e,t,n)=>{if(!y(e.epSquare)||!Fe(e.turn,t).has(e.epSquare))return!1;if(!y(n.king))return!0;const i=e.turn==="white"?8:-8,o=e.epSquare-i;return e.kingAttackers(n.king,K(e.turn),e.board.occupied.toggle(t).toggle(o).with(e.epSquare)).without(o).isEmpty()},Ct=(e,t,n)=>{if(!y(n.king)||n.checkers.nonEmpty())return h.empty();const i=e.castles.rook[e.turn][t];if(!y(i)||e.castles.path[e.turn][t].intersects(e.board.occupied))return h.empty();const o=lt(e.turn,t),r=ye(n.king,o),s=e.board.occupied.without(n.king);for(const u of r)if(e.kingAttackers(u,K(e.turn),s).nonEmpty())return h.empty();const c=at(e.turn,t),a=e.board.occupied.toggle(n.king).toggle(i).toggle(c);return e.kingAttackers(o,K(e.turn),a).nonEmpty()?h.empty():h.fromSquare(i)},Jt=(e,t)=>{if(Re(t))return;const n=t.to-t.from;if(!(Math.abs(n)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return n>0?"h":"a"},Qn=(e,t)=>{const n=Jt(e,t);if(!n)return t;const i=e.castles.rook[e.turn][n];return{from:t.from,to:y(i)?i:t.to}};class G{constructor(){}static empty(){const t=new G;for(const n of W)t[n]=0;return t}static fromBoard(t,n){const i=new G;for(const o of W)i[o]=t.pieces(n,o).size();return i}clone(){const t=new G;for(const n of W)t[n]=this[n];return t}equals(t){return W.every(n=>this[n]===t[n])}add(t){const n=new G;for(const i of W)n[i]=this[i]+t[i];return n}subtract(t){const n=new G;for(const i of W)n[i]=this[i]-t[i];return n}nonEmpty(){return W.some(t=>this[t]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class oe{constructor(t,n){this.white=t,this.black=n}static empty(){return new oe(G.empty(),G.empty())}static fromBoard(t){return new oe(G.fromBoard(t,"white"),G.fromBoard(t,"black"))}clone(){return new oe(this.white.clone(),this.black.clone())}equals(t){return this.white.equals(t.white)&&this.black.equals(t.black)}add(t){return new oe(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new oe(this.white.subtract(t.white),this.black.subtract(t.black))}count(t){return this.white[t]+this.black[t]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class Pe{constructor(t,n){this.white=t,this.black=n}static default(){return new Pe(3,3)}clone(){return new Pe(this.white,this.black)}equals(t){return this.white===t.white&&this.black===t.black}}const Jn=()=>({board:ce.default(),pockets:void 0,turn:"white",castlingRights:h.corners(),epSquare:void 0,remainingChecks:void 0,halfmoves:0,fullmoves:1});var D;(function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"})(D||(D={}));class L extends Error{}const Vn=(e,t,n)=>{let i=e.indexOf(t);for(;n-- >0&&i!==-1;)i=e.indexOf(t,i+t.length);return i},me=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,Vt=e=>{const t=Qe(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},qe=e=>{const t=ce.empty();let n=7,i=0;for(let o=0;o<e.length;o++){const r=e[o];if(r==="/"&&i===8)i=0,n--;else{const s=parseInt(r,10);if(s>0)i+=s;else{if(i>=8||n<0)return C.err(new L(D.Board));const c=i+n*8,a=Vt(r);if(!a)return C.err(new L(D.Board));e[o+1]==="~"&&(a.promoted=!0,o++),t.set(c,a),i++}}}return n!==0||i!==8?C.err(new L(D.Board)):C.ok(t)},Mt=e=>{if(e.length>64)return C.err(new L(D.Pockets));const t=oe.empty();for(const n of e){const i=Vt(n);if(!i)return C.err(new L(D.Pockets));t[i.color][i.role]++}return C.ok(t)},ei=(e,t)=>{let n=h.empty();if(t==="-")return C.ok(n);for(const i of t){const o=i.toLowerCase(),r=i===o?"black":"white",s=r==="white"?0:7;if("a"<=o&&o<="h")n=n.with(Ye(o.charCodeAt(0)-97,s));else if(o==="k"||o==="q"){const c=e[r].intersect(h.backrank(r)).intersect(e.rook.union(e.king)),a=o==="k"?c.last():c.first();n=n.with(y(a)&&e.rook.has(a)?a:Ye(o==="k"?7:0,s))}else return C.err(new L(D.Castling))}return ae.some(i=>h.backrank(i).intersect(n).size()>2)?C.err(new L(D.Castling)):C.ok(n)},St=e=>{const t=e.split("+");if(t.length===3&&t[0]===""){const n=me(t[1]),i=me(t[2]);return!y(n)||n>3||!y(i)||i>3?C.err(new L(D.RemainingChecks)):C.ok(new Pe(3-n,3-i))}else if(t.length===2){const n=me(t[0]),i=me(t[1]);return!y(n)||n>3||!y(i)||i>3?C.err(new L(D.RemainingChecks)):C.ok(new Pe(n,i))}else return C.err(new L(D.RemainingChecks))},ti=e=>{const t=e.split(/[\s_]+/),n=t.shift();let i,o=C.ok(void 0);if(n.endsWith("]")){const c=n.indexOf("[");if(c===-1)return C.err(new L(D.Fen));i=qe(n.slice(0,c)),o=Mt(n.slice(c+1,-1))}else{const c=Vn(n,"/",7);c===-1?i=qe(n):(i=qe(n.slice(0,c)),o=Mt(n.slice(c+1)))}let r;const s=t.shift();if(!y(s)||s==="w")r="white";else if(s==="b")r="black";else return C.err(new L(D.Turn));return i.chain(c=>{const a=t.shift(),u=y(a)?ei(c,a):C.ok(h.empty()),g=t.shift();let d;if(y(g)&&g!=="-"&&(d=se(g),!y(d)))return C.err(new L(D.EpSquare));let A=t.shift(),M;y(A)&&A.includes("+")&&(M=St(A),A=t.shift());const l=y(A)?me(A):0;if(!y(l))return C.err(new L(D.Halfmoves));const f=t.shift(),m=y(f)?me(f):1;if(!y(m))return C.err(new L(D.Fullmoves));const p=t.shift();let b=C.ok(void 0);if(y(p)){if(y(M))return C.err(new L(D.RemainingChecks));b=St(p)}else y(M)&&(b=M);return t.length>0?C.err(new L(D.Fen)):o.chain(S=>u.chain(k=>b.map(v=>({board:c,pockets:S,turn:r,castlingRights:k,remainingChecks:v,epSquare:d,halfmoves:l,fullmoves:Math.max(1,m)}))))})},ni=e=>{let t=Zt(e.role);return e.color==="white"&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t},ii=e=>{let t="",n=0;for(let i=7;i>=0;i--)for(let o=0;o<8;o++){const r=o+i*8,s=e.get(r);s?(n>0&&(t+=n,n=0),t+=ni(s)):n++,o===7&&(n>0&&(t+=n,n=0),i!==0&&(t+="/"))}return t},Et=e=>W.map(t=>Zt(t).repeat(e[t])).join(""),oi=e=>Et(e.white).toUpperCase()+Et(e.black),ri=(e,t)=>{let n="";for(const i of ae){const o=h.backrank(i);let r=e.kingOf(i);y(r)&&!o.has(r)&&(r=void 0);const s=e.pieces(i,"rook").intersect(o);for(const c of t.intersect(o).reversed())if(c===s.first()&&y(r)&&c<r)n+=i==="white"?"Q":"q";else if(c===s.last()&&y(r)&&r<c)n+=i==="white"?"K":"k";else{const a=Ut[V(c)];n+=i==="white"?a.toUpperCase():a}}return n||"-"},si=e=>`${e.white}+${e.black}`,ci=(e,t)=>[ii(e.board)+(e.pockets?`[${oi(e.pockets)}]`:""),e.turn[0],ri(e.board,e.castlingRights),y(e.epSquare)?ge(e.epSquare):"-",...e.remainingChecks?[si(e.remainingChecks)]:[],Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))].join(" "),At=(e,t)=>{const n=new Map,i=e.ctx();for(const[o,r]of e.allDests(i))if(r.nonEmpty()){const s=Array.from(r,ge);o===i.king&&V(o)===4&&(r.has(0)?s.push("c1"):r.has(56)&&s.push("c8"),r.has(7)?s.push("g1"):r.has(63)&&s.push("g8")),n.set(ge(o),s)}return n},xt=e=>Re(e)?[ge(e.to)]:[ge(e.from),ge(e.to)];class li{constructor(t){Y(this,"_promotion");Y(this,"_isPromotionOpen",!1);this.redraw=t}get promotion(){return this._promotion}set promotion(t){this._promotion=t}isOpen(){return this._isPromotionOpen}close(){this._isPromotionOpen=!1}async open(t,n,i){const o=await new Promise(r=>{this.promotion={dest:t,orig:n,color:i,resolve:r},this._isPromotionOpen=!0,this.redraw()});return this.close(),this.promotion=void 0,this.redraw(),o}applyPromotion(t,n,i,o,r){"promotion"in o&&(o.promotion=i,n.role=i,n.promoted=!0,r.setPieces(new Map([[t,n]])))}isPromotion(t,n){return n.role==="pawn"&&(n.color==="white"&&t[1]==="8"||n.color==="black"&&t[1]==="1")}}class ai{constructor(t,n){Y(this,"ground");Y(this,"pos");Y(this,"promotionHandler");Y(this,"puzzleMainMoves");Y(this,"currentPuzzleMove",0);if(this.redraw=n,this.promotionHandler=new li(n),this.puzzleMainMoves=[de("g2g8"),de("f8g8"),{...de("f7f8"),promotion:"knight"},de("h7h8"),de("c7h7")],!t)this.pos=Pt.fromSetup(Jn()).unwrap();else{const i=ti(t).unwrap();this.pos=Pt.fromSetup(i).unwrap()}}setGround(t){this.ground=t,this.setBoardToPosition(!0)}cgState(){return{movable:{free:!1,dests:At(this.pos),events:{after:(t,n,i)=>this.handleMove(t,n)}}}}isPromotionPromptOpened(){return this.promotionHandler.isOpen()}resolvePromotion(t){if(this.isPromotionPromptOpened()){const n={from:se(this.promotionHandler.promotion.orig),to:se(this.promotionHandler.promotion.dest),promotion:t};return this.isPuzzleMove(n)?(this.makeMove(n),this.makeOpponentMove()):this.handleBlunderMove(this.promotionHandler.promotion.dest),this.promotionHandler.promotion.resolve(t)}else throw new Error("Trying to resolve promotion when promotion prompt is not opened")}isPuzzleMove(t){const n=this.puzzleMainMoves[this.currentPuzzleMove];return t.from==n.from&&t.to==n.to&&t.promotion==n.promotion}makeOpponentMove(){this.currentPuzzleMove++,!(this.currentPuzzleMove>=this.puzzleMainMoves.length)&&setTimeout(()=>{var n;const t=xt(this.puzzleMainMoves[this.currentPuzzleMove]);(n=this.ground)==null||n.move(t[0],t[1]),this.handleMove(t[0],t[1],!0),this.currentPuzzleMove++},200)}handleMove(t,n,i=!1){const o=`${t}${n}`,r=de(o);if(!r)return;const s=this.ground.state.pieces.get(n);if(s){if(this.promotionHandler.isPromotion(n,s)){this.handlePromotion(n,t,s,r);return}if(this.handleEnPassant(t,n),i)this.makeMove(r,i);else{if(this.currentPuzzleMove>=this.puzzleMainMoves.length)return;this.isPuzzleMove(r)?(this.makeMove(r,i),this.makeOpponentMove()):this.handleBlunderMove(n)}}}handleBlunderMove(t){var n;(n=this.ground)==null||n.setAutoShapes([{orig:t,customSvg:{html:Rt["✗"]}}]),setTimeout(()=>{this.setBoardToPosition()},300)}cancelPromotion(){if(this.isPromotionPromptOpened())return this.promotionHandler.promotion.resolve(null);throw new Error("Trying to resolve promotion when promotion prompt is not opened")}getPromotionDest(){if(this.isPromotionPromptOpened())return this.promotionHandler.promotion.dest;throw new Error("Trying to get promotion dest when promotion prompt is not opened")}getPromotionColor(){if(this.isPromotionPromptOpened())return this.promotionHandler.promotion.color;throw new Error("Trying to get promotion color when promotion prompt is not opened")}async handlePromotion(t,n,i,o){const r=await this.promotionHandler.open(t,n,i.color);r?this.promotionHandler.applyPromotion(t,i,r,o,this.ground):this.setBoardToPosition()}handleEnPassant(t,n){const i=this.getEnPassantCaptureSquare(t,n,o=>this.pos.board.get(se(o)));i&&this.ground.setPieces(new Map([[i,void 0]]))}getEnPassantCaptureSquare(t,n,i){const o=i(t);if(!o||o.role!=="pawn")return;const r=t.charCodeAt(0),s=n.charCodeAt(0);if(Math.abs(r-s)===1&&!i(n)){const c=parseInt(n[1]),a=o.color==="white"?c-1:c+1;return String.fromCharCode(s)+a}}makeMove(t,n=!1){var i,o;this.pos.play(t),this.updateLegalMoves(),n?(o=this.ground)==null||o.setAutoShapes([]):(i=this.ground)==null||i.setAutoShapes([{orig:xt(t)[1],customSvg:{html:Rt["✓"]}}])}setBoardToPosition(t=!1){var n;t&&this.ground.set({animation:{enabled:!1}}),this.ground.set({fen:ci(this.pos.toSetup())}),this.updateLegalMoves(),(n=this.ground)==null||n.setAutoShapes([]),t&&this.ground.set({animation:{enabled:!0}})}updateLegalMoves(){this.ground.set({movable:{dests:At(this.pos)}})}}const Ot=e=>`<defs><filter id="shadow"><feDropShadow dx="4" dy="7" stdDeviation="5" flood-opacity="0.5" /></filter></defs>
  <g transform="translate(60 0) scale(0.4)">${e}</g>`,Rt={"✓":Ot(`
  <circle style="fill:#22ac38;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M87 32.8q0 2-1.4 3.2L51 70.6 44.6 77q-1.7 1.3-3.4 1.3-1.8 0-3.1-1.3L14.3 53.3Q13 52 13 50q0-2 1.3-3.2l6.4-6.5Q22.4 39 24 39q1.9 0 3.2 1.3l14 14L72.7 23q1.3-1.3 3.2-1.3 1.6 0 3.3 1.3l6.4 6.5q1.3 1.4 1.3 3.4z"/>
`),"✗":Ot(`
  <circle style="fill:#df5353;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M79.4 68q0 1.8-1.4 3.2l-6.7 6.7q-1.4 1.4-3.5 1.4-1.9 0-3.3-1.4L50 63.4 35.5 78q-1.4 1.4-3.3 1.4-2 0-3.5-1.4L22 71.2q-1.4-1.4-1.4-3.3 0-1.7 1.4-3.5L36.5 50 22 35.4Q20.6 34 20.6 32q0-1.7 1.4-3.5l6.7-6.5q1.2-1.4 3.5-1.4 2 0 3.3 1.4L50 36.6 64.5 22q1.2-1.4 3.3-1.4 2.3 0 3.5 1.4l6.7 6.5q1.4 1.8 1.4 3.5 0 2-1.4 3.3L63.5 49.9 78 64.4q1.4 1.8 1.4 3.5z"/>
`)},ui=["white","black"],Ne=["a","b","c","d","e","f","g","h"],Le=["1","2","3","4","5","6","7","8"],fi=[...Le].reverse(),ut=Array.prototype.concat(...Ne.map(e=>Le.map(t=>e+t))),F=e=>ut[8*e[0]+e[1]],T=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],en=ut.map(T);function hi(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const di=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},ft=e=>e==="white"?"black":"white",Ce=(e,t)=>{const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},it=(e,t)=>e.role===t.role&&e.color===t.color,Ee=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],j=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},tn=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},ht=(e,t)=>{e.style.visibility=t?"visible":"hidden"},fe=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},nn=e=>e.button===2,Z=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function on(e,t,n){const i=T(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}const ue=(e,t)=>Math.abs(e-t),pi=e=>(t,n,i,o)=>ue(t,i)<2&&(e==="white"?o===n+1||n<=1&&o===n+2&&t===i:o===n-1||n>=6&&o===n-2&&t===i),rn=(e,t,n,i)=>{const o=ue(e,n),r=ue(t,i);return o===1&&r===2||o===2&&r===1},sn=(e,t,n,i)=>ue(e,n)===ue(t,i),cn=(e,t,n,i)=>e===n||t===i,ln=(e,t,n,i)=>sn(e,t,n,i)||cn(e,t,n,i),mi=(e,t,n)=>(i,o,r,s)=>ue(i,r)<2&&ue(o,s)<2||n&&o===s&&o===(e==="white"?0:7)&&(i===4&&(r===2&&t.includes(0)||r===6&&t.includes(7))||t.includes(r));function gi(e,t){const n=t==="white"?"1":"8",i=[];for(const[o,r]of e)o[1]===n&&r.color===t&&r.role==="rook"&&i.push(T(o)[0]);return i}function an(e,t,n){const i=e.get(t);if(!i)return[];const o=T(t),r=i.role,s=r==="pawn"?pi(i.color):r==="knight"?rn:r==="bishop"?sn:r==="rook"?cn:r==="queen"?ln:mi(i.color,gi(e,i.color),n);return en.filter(c=>(o[0]!==c[0]||o[1]!==c[1])&&s(o[0],o[1],c[0],c[1])).map(F)}function B(e,...t){e&&setTimeout(()=>e(...t),1)}function wi(e){e.orientation=ft(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function bi(e,t){for(const[n,i]of t)i?e.pieces.set(n,i):e.pieces.delete(n)}function ki(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=n)}function vi(e,t,n,i){ne(e),e.premovable.current=[t,n],B(e.premovable.events.set,t,n,i)}function te(e){e.premovable.current&&(e.premovable.current=void 0,B(e.premovable.events.unset))}function yi(e,t,n){te(e),e.predroppable.current={role:t,key:n},B(e.predroppable.events.set,t,n)}function ne(e){const t=e.predroppable;t.current&&(t.current=void 0,B(t.events.unset))}function Pi(e,t,n){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const o=T(t),r=T(n);if(o[1]!==0&&o[1]!==7||o[1]!==r[1])return!1;o[0]===4&&!e.pieces.has(n)&&(r[0]===6?n=F([7,r[1]]):r[0]===2&&(n=F([0,r[1]])));const s=e.pieces.get(n);return!s||s.color!==i.color||s.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),o[0]<r[0]?(e.pieces.set(F([6,r[1]]),i),e.pieces.set(F([5,r[1]]),s)):(e.pieces.set(F([2,r[1]]),i),e.pieces.set(F([3,r[1]]),s)),!0)}function un(e,t,n){const i=e.pieces.get(t),o=e.pieces.get(n);if(t===n||!i)return!1;const r=o&&o.color!==i.color?o:void 0;return n===e.selected&&q(e),B(e.events.move,t,n,r),Pi(e,t,n)||(e.pieces.set(n,i),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,B(e.events.change),r||!0}function dt(e,t,n,i){if(e.pieces.has(n))if(i)e.pieces.delete(n);else return!1;return B(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,B(e.events.change),e.movable.dests=void 0,e.turnColor=ft(e.turnColor),!0}function fn(e,t,n){const i=un(e,t,n);return i&&(e.movable.dests=void 0,e.turnColor=ft(e.turnColor),e.animation.current=void 0),i}function hn(e,t,n){if(pt(e,t,n)){const i=fn(e,t,n);if(i){const o=e.hold.stop();q(e);const r={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return i!==!0&&(r.captured=i),B(e.movable.events.after,t,n,r),!0}}else if(Mi(e,t,n))return vi(e,t,n,{ctrlKey:e.stats.ctrlKey}),q(e),!0;return q(e),!1}function dn(e,t,n,i){const o=e.pieces.get(t);o&&(Ci(e,t,n)||i)?(e.pieces.delete(t),dt(e,o,n,i),B(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&Si(e,t,n)?yi(e,o.role,n):(te(e),ne(e)),e.pieces.delete(t),q(e)}function ot(e,t,n){if(B(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){q(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&hn(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(mn(e,t)||mt(e,t))&&(pn(e,t),e.hold.start())}function pn(e,t){e.selected=t,mt(e,t)?e.premovable.customDests||(e.premovable.dests=an(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function q(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function mn(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const pt=(e,t,n)=>{var i,o;return t!==n&&mn(e,t)&&(e.movable.free||!!(!((o=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||o===void 0)&&o.includes(n)))};function Ci(e,t,n){const i=e.pieces.get(t);return!!i&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function mt(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Mi(e,t,n){var i,o;const r=(o=(i=e.premovable.customDests)===null||i===void 0?void 0:i.get(t))!==null&&o!==void 0?o:an(e.pieces,t,e.premovable.castle);return t!==n&&mt(e,t)&&r.includes(n)}function Si(e,t,n){const i=e.pieces.get(t),o=e.pieces.get(n);return!!i&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function Ei(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Ai(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],i=t[1];let o=!1;if(pt(e,n,i)){const r=fn(e,n,i);if(r){const s={premove:!0};r!==!0&&(s.captured=r),B(e.movable.events.after,n,i,s),o=!0}}return te(e),o}function xi(e,t){const n=e.predroppable.current;let i=!1;if(!n)return!1;if(t(n)){const o={role:n.role,color:e.movable.color};dt(e,o,n.key)&&(B(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return ne(e),i}function gt(e){te(e),ne(e),q(e)}function Tt(e){e.movable.color=e.movable.dests=e.animation.current=void 0,gt(e)}function he(e,t,n){let i=Math.floor(8*(e[0]-n.left)/n.width);t||(i=7-i);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(o=7-o),i>=0&&i<8&&o>=0&&o<8?F([i,o]):void 0}function Oi(e,t,n,i){const o=T(e),r=en.filter(u=>ln(o[0],o[1],u[0],u[1])||rn(o[0],o[1],u[0],u[1])),c=r.map(u=>on(F(u),n,i)).map(u=>Ce(t,u)),[,a]=c.reduce((u,g,d)=>u[0]<g?u:[g,d],[c[0],0]);return F(r[a])}const H=e=>e.orientation==="white",gn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Ri={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Ti={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function wn(e){e==="start"&&(e=gn);const t=new Map;let n=7,i=0;for(const o of e)switch(o){case" ":case"[":return t;case"/":if(--n,n<0)return t;i=0;break;case"~":{const r=t.get(F([i-1,n]));r&&(r.promoted=!0);break}default:{const r=o.charCodeAt(0);if(r<57)i+=r-48;else{const s=o.toLowerCase();t.set(F([i,n]),{role:Ri[s],color:o===s?"black":"white"}),++i}}}return t}function zi(e){return fi.map(t=>Ne.map(n=>{const i=e.get(n+t);if(i){let o=Ti[i.role];return i.color==="white"&&(o=o.toUpperCase()),i.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function bn(e,t){t.animation&&(wt(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function kn(e,t){var n,i,o;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),wt(e,t),t.fen&&(e.pieces=wn(t.fen),e.drawable.shapes=((o=t.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in t&&ki(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&pn(e,e.selected),bn(e,t),!e.movable.rookCastle&&e.movable.dests){const r=e.movable.color==="white"?"1":"8",s="e"+r,c=e.movable.dests.get(s),a=e.pieces.get(s);if(!c||!a||a.role!=="king")return;e.movable.dests.set(s,c.filter(u=>!(u==="a"+r&&c.includes("c"+r))&&!(u==="h"+r&&c.includes("g"+r))))}}function wt(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&zt(e[n])&&zt(t[n])?wt(e[n],t[n]):e[n]=t[n])}function zt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const ie=(e,t)=>t.animation.enabled?Li(e,t):Q(e,t);function Q(e,t){const n=e(t);return t.dom.redraw(),n}const Ie=(e,t)=>({key:e,pos:T(e),piece:t}),Di=(e,t)=>t.sort((n,i)=>Ce(e.pos,n.pos)-Ce(e.pos,i.pos))[0];function Ni(e,t){const n=new Map,i=[],o=new Map,r=[],s=[],c=new Map;let a,u,g;for(const[d,A]of e)c.set(d,Ie(d,A));for(const d of ut)a=t.pieces.get(d),u=c.get(d),a?u?it(a,u.piece)||(r.push(u),s.push(Ie(d,a))):s.push(Ie(d,a)):u&&r.push(u);for(const d of s)u=Di(d,r.filter(A=>it(d.piece,A.piece))),u&&(g=[u.pos[0]-d.pos[0],u.pos[1]-d.pos[1]],n.set(d.key,g.concat(g)),i.push(u.key));for(const d of r)i.includes(d.key)||o.set(d.key,d.piece);return{anims:n,fadings:o}}function vn(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-n.start)*n.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const o=Ki(i);for(const r of n.plan.anims.values())r[2]=r[0]*o,r[3]=r[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>vn(e,r))}}function Li(e,t){const n=new Map(t.pieces),i=e(t),o=Ni(n,t);if(o.anims.size||o.fadings.size){const r=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},r||vn(t,performance.now())}else t.dom.redraw();return i}const Ki=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,$i=["green","red","blue","yellow"];function _i(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?q(e):gt(e);const n=fe(t),i=he(n,H(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:n,brush:qi(t),snapToValidMove:e.drawable.defaultSnapToValidMove},yn(e))}function yn(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=he(t.pos,H(e),e.dom.bounds());n||(t.snapToValidMove=!1);const i=t.snapToValidMove?Oi(t.orig,t.pos,H(e),e.dom.bounds()):n;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),yn(e)}})}function Bi(e,t){e.drawable.current&&(e.drawable.current.pos=fe(t))}function Hi(e){const t=e.drawable.current;t&&(t.mouseSq&&Ii(e.drawable,t),Pn(e))}function Pn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Fi(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Cn(e.drawable))}function qi(e){var t;const n=(e.shiftKey||e.ctrlKey)&&nn(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return $i[(n?1:0)+(i?2:0)]}function Ii(e,t){const n=o=>o.orig===t.orig&&o.dest===t.dest,i=e.shapes.find(n);i&&(e.shapes=e.shapes.filter(o=>!n(o))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Cn(e)}function Cn(e){e.onChange&&e.onChange(e.shapes)}function Wi(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),i=fe(t),o=he(i,H(e),n);if(!o)return;const r=e.pieces.get(o),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!r||r.color!==e.turnColor)&&Fi(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||r||s||ji(e,i)))t.preventDefault();else if(t.touches)return;const c=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&pt(e,e.selected,o)?ie(d=>ot(d,o),e):ot(e,o);const u=e.selected===o,g=Sn(e,o);if(r&&g&&u&&Ei(e,o)){e.draggable.current={orig:o,piece:r,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:g,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},g.cgDragging=!0,g.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className=`ghost ${r.color} ${r.role}`,j(d,Ee(n)(T(o),H(e))),ht(d,!0)),bt(e)}else c&&te(e),a&&ne(e);e.dom.redraw()}function ji(e,t){const n=H(e),i=e.dom.bounds(),o=Math.pow(i.width/8,2);for(const r of e.pieces.keys()){const s=on(r,n,i);if(Ce(s,t)<=o)return!0}return!1}function Gi(e,t,n,i){const o="a0";e.pieces.set(o,t),e.dom.redraw();const r=fe(n);e.draggable.current={orig:o,piece:t,origPos:r,pos:r,started:!0,element:()=>Sn(e,o),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},bt(e)}function bt(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const i=e.pieces.get(n.orig);if(!i||!it(i,n.piece))Ke(e);else if(!n.started&&Ce(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const r=n.element();if(!r)return;r.cgDragging=!0,r.classList.add("dragging"),n.element=r}const o=e.dom.bounds();j(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==he(n.pos,H(e),o))}bt(e)})}function Ui(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=fe(t))}function Zi(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}te(e),ne(e);const i=fe(t)||n.pos,o=he(i,H(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?dn(e,n.orig,o,n.force):(e.stats.ctrlKey=t.ctrlKey,hn(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),B(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?q(e):e.selectable.enabled||q(e),Mn(e),e.draggable.current=void 0,e.dom.redraw()}function Ke(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,q(e),Mn(e),e.dom.redraw())}function Mn(e){const t=e.dom.elements;t.ghost&&ht(t.ghost,!1)}function Sn(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Xi(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Dt(e,2),setTimeout(()=>Dt(e,void 0),120)},120)}function Dt(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Yi(e,t){function n(){wi(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&n(),bn(e,i),(i.fen?ie:Q)(o=>kn(o,i),e)},state:e,getFen:()=>zi(e.pieces),toggleOrientation:n,setPieces(i){ie(o=>bi(o,i),e)},selectSquare(i,o){i?ie(r=>ot(r,i,o),e):e.selected&&(q(e),e.dom.redraw())},move(i,o){ie(r=>un(r,i,o),e)},newPiece(i,o){ie(r=>dt(r,i,o),e)},playPremove(){if(e.premovable.current){if(ie(Ai,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const o=xi(e,i);return e.dom.redraw(),o}return!1},cancelPremove(){Q(te,e)},cancelPredrop(){Q(ne,e)},cancelMove(){Q(i=>{gt(i),Ke(i)},e)},stop(){Q(i=>{Tt(i),Ke(i)},e)},explode(i){Xi(e,i)},setAutoShapes(i){Q(o=>o.drawable.autoShapes=i,e)},setShapes(i){Q(o=>o.drawable.shapes=i,e)},getKeyAtDomPos(i){return he(i,H(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,o,r){Gi(e,i,o,r)},destroy(){Tt(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Qi(){return{pieces:wn(gn),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:di()}}const Nt={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Ji(){const e=N("defs"),t=$(N("filter"),{id:"cg-filter-blur"});return t.appendChild($(N("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function Vi(e,t,n){var i;const o=e.drawable,r=o.current,s=r&&r.mouseSq?r:void 0,c=new Map,a=e.dom.bounds(),u=o.autoShapes.filter(M=>!M.piece);for(const M of o.shapes.concat(u).concat(s?[s]:[])){if(!M.dest)continue;const l=(i=c.get(M.dest))!==null&&i!==void 0?i:new Set,f=Be(_e(T(M.orig),e.orientation),a),m=Be(_e(T(M.dest),e.orientation),a);l.add(st(f,m)),c.set(M.dest,l)}const g=o.shapes.concat(u).map(M=>({shape:M,current:!1,hash:Lt(M,rt(M.dest,c),!1,a)}));s&&g.push({shape:s,current:!0,hash:Lt(s,rt(s.dest,c),!0,a)});const d=g.map(M=>M.hash).join(";");if(d===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=d;const A=t.querySelector("defs");eo(o,g,A),to(g,t.querySelector("g"),n.querySelector("g"),M=>oo(e,M,o.brushes,c,a))}function eo(e,t,n){var i;const o=new Map;let r;for(const a of t.filter(u=>u.shape.dest&&u.shape.brush))r=En(e.brushes[a.shape.brush],a.shape.modifiers),!((i=a.shape.modifiers)===null||i===void 0)&&i.hilite&&o.set($e(r).key,$e(r)),o.set(r.key,r);const s=new Set;let c=n.firstElementChild;for(;c;)s.add(c.getAttribute("cgKey")),c=c.nextElementSibling;for(const[a,u]of o.entries())s.has(a)||n.appendChild(co(u))}function to(e,t,n,i){const o=new Map;for(const r of e)o.set(r.hash,!1);for(const r of[t,n]){const s=[];let c=r.firstElementChild,a;for(;c;)a=c.getAttribute("cgHash"),o.has(a)?o.set(a,!0):s.push(c),c=c.nextElementSibling;for(const u of s)r.removeChild(u)}for(const r of e.filter(s=>!o.get(s.hash)))for(const s of i(r))s.isCustom?n.appendChild(s.el):t.appendChild(s.el)}function Lt({orig:e,dest:t,brush:n,piece:i,modifiers:o,customSvg:r,label:s},c,a,u){var g,d;return[u.width,u.height,a,e,t,n,c&&"-",i&&no(i),o&&io(o),r&&`custom-${Kt(r.html)},${(d=(g=r.center)===null||g===void 0?void 0:g[0])!==null&&d!==void 0?d:"o"}`,s&&`label-${Kt(s.text)}`].filter(A=>A).join(",")}function no(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function io(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function Kt(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function oo(e,{shape:t,current:n,hash:i},o,r,s){var c,a;const u=Be(_e(T(t.orig),e.orientation),s),g=t.dest?Be(_e(T(t.dest),e.orientation),s):u,d=t.brush&&En(o[t.brush],t.modifiers),A=r.get(t.dest),M=[];if(d){const l=$(N("g"),{cgHash:i});M.push({el:l}),u[0]!==g[0]||u[1]!==g[1]?l.appendChild(so(t,d,u,g,n,rt(t.dest,r))):l.appendChild(ro(o[t.brush],u,n,s))}if(t.label){const l=t.label;(c=l.fill)!==null&&c!==void 0||(l.fill=t.brush&&o[t.brush].color);const f=t.brush?void 0:"tr";M.push({el:lo(l,i,u,g,A,f),isCustom:!0})}if(t.customSvg){const l=(a=t.customSvg.center)!==null&&a!==void 0?a:"orig",[f,m]=l==="label"?xn(u,g,A).map(b=>b-.5):l==="dest"?g:u,p=$(N("g"),{transform:`translate(${f},${m})`,cgHash:i});p.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,M.push({el:p,isCustom:!0})}return M}function ro(e,t,n,i){const o=ao(),r=(i.width+i.height)/(4*Math.max(i.width,i.height));return $(N("circle"),{stroke:e.color,"stroke-width":o[n?0:1],fill:"none",opacity:An(e,n),cx:t[0],cy:t[1],r:r-o[1]/2})}function $e(e){return["#ffffff","#fff","white"].includes(e.color)?Nt.hilitePrimary:Nt.hiliteWhite}function so(e,t,n,i,o,r){var s;function c(g){var d;const A=fo(r&&!o),M=i[0]-n[0],l=i[1]-n[1],f=Math.atan2(l,M),m=Math.cos(f)*A,p=Math.sin(f)*A;return $(N("line"),{stroke:g?$e(t).color:t.color,"stroke-width":uo(t,o)+(g?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${g?$e(t).key:t.key})`,opacity:!((d=e.modifiers)===null||d===void 0)&&d.hilite?1:An(t,o),x1:n[0],y1:n[1],x2:i[0]-m,y2:i[1]-p})}if(!(!((s=e.modifiers)===null||s===void 0)&&s.hilite))return c(!1);const a=N("g"),u=$(N("g"),{filter:"url(#cg-filter-blur)"});return u.appendChild(ho(n,i)),u.appendChild(c(!0)),a.appendChild(u),a.appendChild(c(!1)),a}function co(e){const t=$(N("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild($(N("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function lo(e,t,n,i,o,r){var s;const a=.4*.75**e.text.length,u=xn(n,i,o),g=r==="tr"?.4:0,d=$(N("g"),{transform:`translate(${u[0]+g},${u[1]-g})`,cgHash:t});d.appendChild($(N("circle"),{r:.4/2,"fill-opacity":r?1:.8,"stroke-opacity":r?1:.7,"stroke-width":.03,fill:(s=e.fill)!==null&&s!==void 0?s:"#666",stroke:"white"}));const A=$(N("text"),{"font-size":a,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return A.innerHTML=e.text,d.appendChild(A),d}function _e(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function rt(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function N(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function $(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function En(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function ao(){return[3/64,4/64]}function uo(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function An(e,t){return(e.opacity||1)*(t?.9:1)}function fo(e){return(e?20:10)/64}function Be(e,t){const n=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*i]}function ho(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return $(N("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function st(e,t,n=!0){const i=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(i*8/Math.PI)+16)%16:i}function po(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,i)=>n+i*i,0))}function xn(e,t,n){let i=po(e,t);const o=st(e,t,!1);if(n&&(i-=33/64,n.size>1)){i-=10/64;const r=st(e,t);(n.has((r+1)%16)||n.has((r+15)%16))&&r&1&&(i-=.4)}return[e[0]-Math.cos(o)*i,e[1]-Math.sin(o)*i].map(r=>r+.5)}function mo(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const a of ui)e.classList.toggle("orientation-"+a,t.orientation===a);e.classList.toggle("manipulable",!t.viewOnly);const n=Z("cg-container");e.appendChild(n);const i=Z("cg-board");n.appendChild(i);let o,r,s;if(t.drawable.visible&&(o=$(N("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(Ji()),o.appendChild(N("g")),r=$(N("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(N("g")),s=Z("cg-auto-pieces"),n.appendChild(o),n.appendChild(r),n.appendChild(s)),t.coordinates){const a=t.orientation==="black"?" black":"",u=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const g=t.orientation==="white"?d=>d+1:d=>8-d;Ne.forEach((d,A)=>n.appendChild(We(Le.map(M=>d+M),"squares rank"+g(A)+a+u)))}else n.appendChild(We(Le,"ranks"+a+u)),n.appendChild(We(Ne,"files"+a))}let c;return t.draggable.enabled&&t.draggable.showGhost&&(c=Z("piece","ghost"),ht(c,!1),n.appendChild(c)),{board:i,container:n,wrap:e,ghost:c,svg:o,customSvg:r,autoPieces:s}}function We(e,t){const n=Z("coords",t);let i;for(const o of e)i=Z("coord"),i.textContent=o,n.appendChild(i);return n}function go(e,t){if(!e.dropmode.active)return;te(e),ne(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const i=fe(t),o=i&&he(i,H(e),e.dom.bounds());o&&dn(e,"a0",o)}e.dom.redraw()}function wo(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault()),e.viewOnly)return;const i=ko(e);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1})}function bo(e,t){const n=[];if("ResizeObserver"in window||n.push(be(document.body,"chessground.resize",t)),!e.viewOnly){const i=$t(e,Ui,Bi),o=$t(e,Zi,Hi);for(const s of["touchmove","mousemove"])n.push(be(document,s,i));for(const s of["touchend","mouseup"])n.push(be(document,s,o));const r=()=>e.dom.bounds.clear();n.push(be(document,"scroll",r,{capture:!0,passive:!0})),n.push(be(window,"resize",r,{passive:!0}))}return()=>n.forEach(i=>i())}function be(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}const ko=e=>t=>{e.draggable.current?Ke(e):e.drawable.current?Pn(e):t.shiftKey||nn(t)?e.drawable.enabled&&_i(e,t):e.viewOnly||(e.dropmode.active?go(e,t):Wi(e,t))},$t=(e,t,n)=>i=>{e.drawable.current?e.drawable.enabled&&n(e,i):e.viewOnly||t(e,i)};function vo(e){const t=H(e),n=Ee(e.dom.bounds()),i=e.dom.elements.board,o=e.pieces,r=e.animation.current,s=r?r.plan.anims:new Map,c=r?r.plan.fadings:new Map,a=e.draggable.current,u=Po(e),g=new Set,d=new Set,A=new Map,M=new Map;let l,f,m,p,b,S,k,v,P,E;for(f=i.firstChild;f;){if(l=f.cgKey,On(f))if(m=o.get(l),b=s.get(l),S=c.get(l),p=f.cgPiece,f.cgDragging&&(!a||a.orig!==l)&&(f.classList.remove("dragging"),j(f,n(T(l),t)),f.cgDragging=!1),!S&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),m){if(b&&f.cgAnimating&&p===ke(m)){const w=T(l);w[0]+=b[2],w[1]+=b[3],f.classList.add("anim"),j(f,n(w,t))}else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),j(f,n(T(l),t)),e.addPieceZIndex&&(f.style.zIndex=je(T(l),t)));p===ke(m)&&(!S||!f.cgFading)?g.add(l):S&&p===ke(S)?(f.classList.add("fading"),f.cgFading=!0):Ge(A,p,f)}else Ge(A,p,f);else if(Rn(f)){const w=f.className;u.get(l)===w?d.add(l):Ge(M,w,f)}f=f.nextSibling}for(const[w,x]of u)if(!d.has(w)){P=M.get(x),E=P&&P.pop();const R=n(T(w),t);if(E)E.cgKey=w,j(E,R);else{const O=Z("square",x);O.cgKey=w,j(O,R),i.insertBefore(O,i.firstChild)}}for(const[w,x]of o)if(b=s.get(w),!g.has(w))if(k=A.get(ke(x)),v=k&&k.pop(),v){v.cgKey=w,v.cgFading&&(v.classList.remove("fading"),v.cgFading=!1);const R=T(w);e.addPieceZIndex&&(v.style.zIndex=je(R,t)),b&&(v.cgAnimating=!0,v.classList.add("anim"),R[0]+=b[2],R[1]+=b[3]),j(v,n(R,t))}else{const R=ke(x),O=Z("piece",R),z=T(w);O.cgPiece=R,O.cgKey=w,b&&(O.cgAnimating=!0,z[0]+=b[2],z[1]+=b[3]),j(O,n(z,t)),e.addPieceZIndex&&(O.style.zIndex=je(z,t)),i.appendChild(O)}for(const w of A.values())Bt(e,w);for(const w of M.values())Bt(e,w)}function yo(e){const t=H(e),n=Ee(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(On(i)&&!i.cgAnimating||Rn(i))&&j(i,n(T(i.cgKey),t)),i=i.nextSibling}function _t(e){var t,n;const i=e.dom.elements.wrap.getBoundingClientRect(),o=e.dom.elements.container,r=i.height/i.width,s=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,c=s*r;o.style.width=s+"px",o.style.height=c+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",s+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-height",c+"px")}const On=e=>e.tagName==="PIECE",Rn=e=>e.tagName==="SQUARE";function Bt(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function je(e,t){const i=e[1];return`${t?10-i:3+i}`}const ke=e=>`${e.color} ${e.role}`;function Po(e){var t,n,i;const o=new Map;if(e.lastMove&&e.highlight.lastMove)for(const c of e.lastMove)U(o,c,"last-move");if(e.check&&e.highlight.check&&U(o,e.check,"check"),e.selected&&(U(o,e.selected,"selected"),e.movable.showDests)){const c=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(c)for(const u of c)U(o,u,"move-dest"+(e.pieces.has(u)?" oc":""));const a=(i=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(e.selected))!==null&&i!==void 0?i:e.premovable.dests;if(a)for(const u of a)U(o,u,"premove-dest"+(e.pieces.has(u)?" oc":""))}const r=e.premovable.current;if(r)for(const c of r)U(o,c,"current-premove");else e.predroppable.current&&U(o,e.predroppable.current.key,"current-premove");const s=e.exploding;if(s)for(const c of s.keys)U(o,c,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach((c,a)=>{U(o,a,c)}),o}function U(e,t,n){const i=e.get(t);i?e.set(t,`${i} ${n}`):e.set(t,n)}function Ge(e,t,n){const i=e.get(t);i?i.push(n):e.set(t,[n])}function Co(e,t,n){const i=new Map,o=[];for(const c of e)i.set(c.hash,!1);let r=t.firstElementChild,s;for(;r;)s=r.getAttribute("cgHash"),i.has(s)?i.set(s,!0):o.push(r),r=r.nextElementSibling;for(const c of o)t.removeChild(c);for(const c of e)i.get(c.hash)||t.appendChild(n(c))}function Mo(e,t){const i=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Ao(o),current:!1}));Co(i,t,o=>Eo(e,o,e.dom.bounds()))}function So(e){var t;const n=H(e),i=Ee(e.dom.bounds());let o=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;o;)tn(o,i(T(o.cgKey),n),o.cgScale),o=o.nextSibling}function Eo(e,{shape:t,hash:n},i){var o,r,s;const c=t.orig,a=(o=t.piece)===null||o===void 0?void 0:o.role,u=(r=t.piece)===null||r===void 0?void 0:r.color,g=(s=t.piece)===null||s===void 0?void 0:s.scale,d=Z("piece",`${a} ${u}`);return d.setAttribute("cgHash",n),d.cgKey=c,d.cgScale=g,tn(d,Ee(i)(T(c),H(e)),g),d}const Ao=e=>{var t,n,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function xo(e,t){const n=Qi();kn(n,t||{});function i(){const o="dom"in n?n.dom.unbind:void 0,r=mo(e,n),s=hi(()=>r.board.getBoundingClientRect()),c=g=>{vo(u),r.autoPieces&&Mo(u,r.autoPieces),!g&&r.svg&&Vi(u,r.svg,r.customSvg)},a=()=>{_t(u),yo(u),r.autoPieces&&So(u)},u=n;return u.dom={elements:r,bounds:s,redraw:Oo(c),redrawNow:c,unbind:o},u.drawable.prevSvgHash="",_t(u),c(!1),wo(u,a),o||(u.dom.unbind=bo(u,a)),u.events.insert&&u.events.insert(r),u}return Yi(i(),i)}function Oo(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}function Ro(e,t){return document.createElement(e,t)}function To(e,t,n){return document.createElementNS(e,t,n)}function zo(){return le(document.createDocumentFragment())}function Do(e){return document.createTextNode(e)}function No(e){return document.createComment(e)}function Lo(e,t,n){if(X(e)){let i=e;for(;i&&X(i);)i=le(i).parent;e=i??e}X(t)&&(t=le(t,e)),n&&X(n)&&(n=le(n).firstChildNode),e.insertBefore(t,n)}function Ko(e,t){e.removeChild(t)}function $o(e,t){X(t)&&(t=le(t,e)),e.appendChild(t)}function Tn(e){if(X(e)){for(;e&&X(e);)e=le(e).parent;return e??null}return e.parentNode}function _o(e){var t;if(X(e)){const n=le(e),i=Tn(n);if(i&&n.lastChildNode){const o=Array.from(i.childNodes),r=o.indexOf(n.lastChildNode);return(t=o[r+1])!==null&&t!==void 0?t:null}return null}return e.nextSibling}function Bo(e){return e.tagName}function Ho(e,t){e.textContent=t}function Fo(e){return e.textContent}function qo(e){return e.nodeType===1}function Io(e){return e.nodeType===3}function Wo(e){return e.nodeType===8}function X(e){return e.nodeType===11}function le(e,t){var n,i,o;const r=e;return(n=r.parent)!==null&&n!==void 0||(r.parent=t??null),(i=r.firstChildNode)!==null&&i!==void 0||(r.firstChildNode=e.firstChild),(o=r.lastChildNode)!==null&&o!==void 0||(r.lastChildNode=e.lastChild),r}const jo={createElement:Ro,createElementNS:To,createTextNode:Do,createDocumentFragment:zo,createComment:No,insertBefore:Lo,removeChild:Ko,appendChild:$o,parentNode:Tn,nextSibling:_o,tagName:Bo,setTextContent:Ho,getTextContent:Fo,isElement:qo,isText:Io,isComment:Wo,isDocumentFragment:X};function Me(e,t,n,i,o){const r=t===void 0?void 0:t.key;return{sel:e,data:t,children:n,text:i,elm:o,key:r}}const He=Array.isArray;function Oe(e){return typeof e=="string"||typeof e=="number"||e instanceof String||e instanceof Number}function xe(e){return e===void 0}function _(e){return e!==void 0}const Ue=Me("",{},[],void 0,void 0);function ve(e,t){var n,i;const o=e.key===t.key,r=((n=e.data)===null||n===void 0?void 0:n.is)===((i=t.data)===null||i===void 0?void 0:i.is),s=e.sel===t.sel,c=!e.sel&&e.sel===t.sel?typeof e.text==typeof t.text:!0;return s&&o&&r&&c}function Go(){throw new Error("The document fragment is not supported on this platform.")}function Uo(e,t){return e.isElement(t)}function Zo(e,t){return e.isDocumentFragment(t)}function Xo(e,t,n){var i;const o={};for(let r=t;r<=n;++r){const s=(i=e[r])===null||i===void 0?void 0:i.key;s!==void 0&&(o[s]=r)}return o}const Yo=["create","update","remove","destroy","pre","post"];function Qo(e,t,n){const i={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},o=jo;for(const l of Yo)for(const f of e){const m=f[l];m!==void 0&&i[l].push(m)}function r(l){const f=l.id?"#"+l.id:"",m=l.getAttribute("class"),p=m?"."+m.split(" ").join("."):"";return Me(o.tagName(l).toLowerCase()+f+p,{},[],void 0,l)}function s(l){return Me(void 0,{},[],void 0,l)}function c(l,f){return function(){if(--f===0){const p=o.parentNode(l);p!==null&&o.removeChild(p,l)}}}function a(l,f){var m,p,b,S;let k,v=l.data;if(v!==void 0){const w=(m=v.hook)===null||m===void 0?void 0:m.init;_(w)&&(w(l),v=l.data)}const P=l.children,E=l.sel;if(E==="!")xe(l.text)&&(l.text=""),l.elm=o.createComment(l.text);else if(E==="")l.elm=o.createTextNode(l.text);else if(E!==void 0){const w=E.indexOf("#"),x=E.indexOf(".",w),R=w>0?w:E.length,O=x>0?x:E.length,z=w!==-1||x!==-1?E.slice(0,Math.min(R,O)):E,I=l.elm=_(v)&&_(k=v.ns)?o.createElementNS(k,z,v):o.createElement(z,v);for(R<O&&I.setAttribute("id",E.slice(R+1,O)),x>0&&I.setAttribute("class",E.slice(O+1).replace(/\./g," ")),k=0;k<i.create.length;++k)i.create[k](Ue,l);if(Oe(l.text)&&(!He(P)||P.length===0)&&o.appendChild(I,o.createTextNode(l.text)),He(P))for(k=0;k<P.length;++k){const kt=P[k];kt!=null&&o.appendChild(I,a(kt,f))}const Ae=l.data.hook;_(Ae)&&((p=Ae.create)===null||p===void 0||p.call(Ae,Ue,l),Ae.insert&&f.push(l))}else if(!((b=void 0)===null||b===void 0)&&b.fragments&&l.children){for(l.elm=((S=o.createDocumentFragment)!==null&&S!==void 0?S:Go)(),k=0;k<i.create.length;++k)i.create[k](Ue,l);for(k=0;k<l.children.length;++k){const w=l.children[k];w!=null&&o.appendChild(l.elm,a(w,f))}}else l.elm=o.createTextNode(l.text);return l.elm}function u(l,f,m,p,b,S){for(;p<=b;++p){const k=m[p];k!=null&&o.insertBefore(l,a(k,S),f)}}function g(l){var f,m;const p=l.data;if(p!==void 0){(m=(f=p==null?void 0:p.hook)===null||f===void 0?void 0:f.destroy)===null||m===void 0||m.call(f,l);for(let b=0;b<i.destroy.length;++b)i.destroy[b](l);if(l.children!==void 0)for(let b=0;b<l.children.length;++b){const S=l.children[b];S!=null&&typeof S!="string"&&g(S)}}}function d(l,f,m,p){for(var b,S;m<=p;++m){let k,v;const P=f[m];if(P!=null)if(_(P.sel)){g(P),k=i.remove.length+1,v=c(P.elm,k);for(let w=0;w<i.remove.length;++w)i.remove[w](P,v);const E=(S=(b=P==null?void 0:P.data)===null||b===void 0?void 0:b.hook)===null||S===void 0?void 0:S.remove;_(E)?E(P,v):v()}else P.children?(g(P),d(l,P.children,0,P.children.length-1)):o.removeChild(l,P.elm)}}function A(l,f,m,p){let b=0,S=0,k=f.length-1,v=f[0],P=f[k],E=m.length-1,w=m[0],x=m[E],R,O,z,I;for(;b<=k&&S<=E;)v==null?v=f[++b]:P==null?P=f[--k]:w==null?w=m[++S]:x==null?x=m[--E]:ve(v,w)?(M(v,w,p),v=f[++b],w=m[++S]):ve(P,x)?(M(P,x,p),P=f[--k],x=m[--E]):ve(v,x)?(M(v,x,p),o.insertBefore(l,v.elm,o.nextSibling(P.elm)),v=f[++b],x=m[--E]):ve(P,w)?(M(P,w,p),o.insertBefore(l,P.elm,v.elm),P=f[--k],w=m[++S]):(R===void 0&&(R=Xo(f,b,k)),O=R[w.key],xe(O)?(o.insertBefore(l,a(w,p),v.elm),w=m[++S]):xe(R[x.key])?(o.insertBefore(l,a(x,p),o.nextSibling(P.elm)),x=m[--E]):(z=f[O],z.sel!==w.sel?o.insertBefore(l,a(w,p),v.elm):(M(z,w,p),f[O]=void 0,o.insertBefore(l,z.elm,v.elm)),w=m[++S]));S<=E&&(I=m[E+1]==null?null:m[E+1].elm,u(l,I,m,S,E,p)),b<=k&&d(l,f,b,k)}function M(l,f,m){var p,b,S,k,v,P,E,w;const x=(p=f.data)===null||p===void 0?void 0:p.hook;(b=x==null?void 0:x.prepatch)===null||b===void 0||b.call(x,l,f);const R=f.elm=l.elm;if(l===f)return;if(f.data!==void 0||_(f.text)&&f.text!==l.text){(S=f.data)!==null&&S!==void 0||(f.data={}),(k=l.data)!==null&&k!==void 0||(l.data={});for(let I=0;I<i.update.length;++I)i.update[I](l,f);(E=(P=(v=f.data)===null||v===void 0?void 0:v.hook)===null||P===void 0?void 0:P.update)===null||E===void 0||E.call(P,l,f)}const O=l.children,z=f.children;xe(f.text)?_(O)&&_(z)?O!==z&&A(R,O,z,m):_(z)?(_(l.text)&&o.setTextContent(R,""),u(R,null,z,0,z.length-1,m)):_(O)?d(R,O,0,O.length-1):_(l.text)&&o.setTextContent(R,""):l.text!==f.text&&(_(O)&&d(R,O,0,O.length-1),o.setTextContent(R,f.text)),(w=x==null?void 0:x.postpatch)===null||w===void 0||w.call(x,l,f)}return function(f,m){let p,b,S;const k=[];for(p=0;p<i.pre.length;++p)i.pre[p]();for(Uo(o,f)?f=r(f):Zo(o,f)&&(f=s(f)),ve(f,m)?M(f,m,k):(b=f.elm,S=o.parentNode(b),a(m,k),S!==null&&(o.insertBefore(S,m.elm,o.nextSibling(b)),d(S,[f],0,0))),p=0;p<k.length;++p)k[p].data.hook.insert(k[p]);for(p=0;p<i.post.length;++p)i.post[p]();return m}}function zn(e,t,n){if(e.ns="http://www.w3.org/2000/svg",n!=="foreignObject"&&t!==void 0)for(let i=0;i<t.length;++i){const o=t[i];if(typeof o=="string")continue;const r=o.data;r!==void 0&&zn(r,o.children,o.sel)}}function we(e,t,n){let i={},o,r,s;if(n!==void 0?(t!==null&&(i=t),He(n)?o=n:Oe(n)?r=n.toString():n&&n.sel&&(o=[n])):t!=null&&(He(t)?o=t:Oe(t)?r=t.toString():t&&t.sel?o=[t]:i=t),o!==void 0)for(s=0;s<o.length;++s)Oe(o[s])&&(o[s]=Me(void 0,void 0,void 0,o[s],void 0));return e.startsWith("svg")&&(e.length===3||e[3]==="."||e[3]==="#")&&zn(i,o,e),Me(e,i,o,r,void 0)}const Jo="http://www.w3.org/1999/xlink",Vo="http://www.w3.org/2000/xmlns/",er="http://www.w3.org/XML/1998/namespace",Ht=58,tr=120,nr=109;function Ft(e,t){let n;const i=t.elm;let o=e.data.attrs,r=t.data.attrs;if(!(!o&&!r)&&o!==r){o=o||{},r=r||{};for(n in r){const s=r[n];o[n]!==s&&(s===!0?i.setAttribute(n,""):s===!1?i.removeAttribute(n):n.charCodeAt(0)!==tr?i.setAttribute(n,s):n.charCodeAt(3)===Ht?i.setAttributeNS(er,n,s):n.charCodeAt(5)===Ht?n.charCodeAt(1)===nr?i.setAttributeNS(Vo,n,s):i.setAttributeNS(Jo,n,s):i.setAttribute(n,s))}for(n in o)n in r||i.removeAttribute(n)}}const ir={create:Ft,update:Ft};function qt(e,t){let n,i;const o=t.elm;let r=e.data.class,s=t.data.class;if(!(!r&&!s)&&r!==s){r=r||{},s=s||{};for(i in r)r[i]&&!Object.prototype.hasOwnProperty.call(s,i)&&o.classList.remove(i);for(i in s)n=s[i],n!==r[i]&&o.classList[n?"add":"remove"](i)}}const or={create:qt,update:qt};function Dn(e,t,n){if(typeof e=="function")e.call(t,n,t);else if(typeof e=="object")for(let i=0;i<e.length;i++)Dn(e[i],t,n)}function rr(e,t){const n=e.type,i=t.data.on;i&&i[n]&&Dn(i[n],t,e)}function sr(){return function e(t){rr(t,e.vnode)}}function Ze(e,t){const n=e.data.on,i=e.listener,o=e.elm,r=t&&t.data.on,s=t&&t.elm;let c;if(n!==r){if(n&&i)if(r)for(c in n)r[c]||o.removeEventListener(c,i,!1);else for(c in n)o.removeEventListener(c,i,!1);if(r){const a=t.listener=e.listener||sr();if(a.vnode=t,n)for(c in r)n[c]||s.addEventListener(c,a,!1);else for(c in r)s.addEventListener(c,a,!1)}}}const cr={create:Ze,update:Ze,destroy:Ze},It=typeof(window==null?void 0:window.requestAnimationFrame)=="function"?window.requestAnimationFrame.bind(window):setTimeout,lr=function(e){It(function(){It(e)})};let ct=!1;function ar(e,t,n){lr(function(){e[t]=n})}function Wt(e,t){let n,i;const o=t.elm;let r=e.data.style,s=t.data.style;if(!r&&!s||r===s)return;r=r||{},s=s||{};const c="delayed"in r;for(i in r)i in s||(i[0]==="-"&&i[1]==="-"?o.style.removeProperty(i):o.style[i]="");for(i in s)if(n=s[i],i==="delayed"&&s.delayed)for(const a in s.delayed)n=s.delayed[a],(!c||n!==r.delayed[a])&&ar(o.style,a,n);else i!=="remove"&&n!==r[i]&&(i[0]==="-"&&i[1]==="-"?o.style.setProperty(i,n):o.style[i]=n)}function ur(e){let t,n;const i=e.elm,o=e.data.style;if(!(!o||!(t=o.destroy)))for(n in t)i.style[n]=t[n]}function fr(e,t){const n=e.data.style;if(!n||!n.remove){t();return}ct||(e.elm.offsetLeft,ct=!0);let i;const o=e.elm;let r=0;const s=n.remove;let c=0;const a=[];for(i in s)a.push(i),o.style[i]=s[i];const g=getComputedStyle(o)["transition-property"].split(", ");for(;r<g.length;++r)a.indexOf(g[r])!==-1&&c++;o.addEventListener("transitionend",function(d){d.target===o&&--c,c===0&&t()})}function hr(){ct=!1}const dr={pre:hr,create:Wt,update:Wt,destroy:ur,remove:fr};function pr(e){return{insert:t=>e(t.elm)}}function jt(e){return we("div.blue.merida",{attrs:{tabindex:0},class:{darken:e.isPromotionPromptOpened()},hook:pr(t=>{e.setGround(xo(t.querySelector(".cg-wrap"),wr(e,t)))})},[mr(e)])}const mr=e=>we("div.lpv__board",we("div.cg-wrap",{class:{"cg-promotion":e.isPromotionPromptOpened(),"cg-promotion--open":e.isPromotionPromptOpened()},on:{click:()=>{e.isPromotionPromptOpened()&&e.cancelPromotion()}}},e.isPromotionPromptOpened()?gr(e):void 0)),gr=e=>{const t=["queen","knight","rook","bishop"],n=e.getPromotionDest(),i=e.getPromotionColor(),o=e.cgState().orientation;let r=n.charCodeAt(0)-97,s=i=="white"?0:7,c=i=="white"?1:-1;return o=="black"&&(r=7-r,s=7-s,c*=-1),t.map((u,g)=>we("cg-board",we("square.blue.merida",{style:{top:`${(s+g*c)*12.5}%`,left:`${r*12.5}%`},on:{click:()=>e.resolvePromotion(u)}},we(`piece.${i}.${u}`))))};function wr(e,t){return{viewOnly:!1,addDimensionsCssVarsTo:t,animation:{enabled:!0,duration:300},drawable:{enabled:!0,visible:!0},disableContextMenu:!0,movable:{free:!1},draggable:{enabled:!0},selectable:{enabled:!0},...e.cgState()}}function br(e){const t=Qo([or,ir,dr,cr]),n=new ai("5r2/2R2P1k/7p/4q3/7K/8/6Q1/8 w - - 0 1",r),i=jt(n);e.innerHTML="";let o=t(e,i);function r(){o=t(o,jt(n))}return n}br(document.getElementById("app"));
